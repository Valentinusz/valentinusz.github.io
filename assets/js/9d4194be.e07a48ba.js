"use strict";(self.webpackChunkvalentinusz_github_io=self.webpackChunkvalentinusz_github_io||[]).push([[9722],{3451:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var a=n(5893),r=n(1151);const o={sidebar_position:1,title:"WordCount"},s=void 0,i={id:"bigdata/hadoop/wordcount",title:"WordCount",description:"A feladathoz kapcsol\xf3d\xf3 k\xf3dok megtal\xe1lhat\xf3k",source:"@site/notes/bigdata/hadoop/wordcount.md",sourceDirName:"bigdata/hadoop",slug:"/bigdata/hadoop/wordcount",permalink:"/notes/bigdata/hadoop/wordcount",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Boda B\xe1lint",lastUpdatedAt:1698432915,formattedLastUpdatedAt:"2023. okt. 27.",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"WordCount"},sidebar:"notesSidebar",previous:{title:"Hadoop",permalink:"/notes/bigdata/hadoop/intro"},next:{title:"grep",permalink:"/notes/bigdata/hadoop/grep"}},d={},l=[];function c(e){const t={a:"a",admonition:"admonition",code:"code",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsxs)(t.p,{children:["A feladathoz kapcsol\xf3d\xf3 k\xf3dok megtal\xe1lhat\xf3k\na ",(0,a.jsx)(t.a,{href:"https://github.com/Valentinusz/elte-ik-bsc/tree/main/5/bigdata/hadoop/wordCount",children:"GitHub repoban"}),"."]})}),"\n",(0,a.jsx)(t.p,{children:"A MapReduce Hello World!-jek\xe9nt emlegedett feladat a k\xf6vetkez\u0151: Adott egy bemeneti f\xe1jl, sz\xe1moljuk meg az egyes szavak\nh\xe1nyszor fordulnak el\u0151 a f\xe1jlban!"}),"\n",(0,a.jsx)(t.p,{children:"A Hadoop MapReduce egy Java nyelv\u0171 implement\xe1ci\xf3ja a MapReduce modellnek."}),"\n",(0,a.jsxs)(t.p,{children:["A f\u0151program, amit a ",(0,a.jsx)(t.code,{children:"WordCountDriver"})," oszt\xe1lyban helyez\xfcnk el felel a MapReduce motor konfigur\xe1l\xe1s\xe1\xe9rt."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",metastring:'title="src/wordcount/WordCountDriver.java"',children:'package wordcount;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\npublic class WordCountDriver {\n    public static void main(String[] args) throws Exception {\n        // HDFS itt t\xe1rolja az ideiglenes f\xe1jlokat\n        System.setProperty("hadoop.tmp.dir", "c:\\\\BigData\\\\tmp\\\\hadoop-xx");\n        \n        // k\xf6nyvt\xe1r ahol a Hadoop telep\xedtve van\n        System.setProperty("hadoop.home.dir", "c:\\\\BigData\\\\hadoop-3.3.6");\n        \n        Configuration conf = new Configuration();\n        \n        // job neve igaz\xe1b\xf3l nem sz\xe1m\xedt\n        Job job = Job.getInstance(conf, "WordCount"); \n        \n        job.setJarByClass(wordcount.WordCountDriver.class);\n        \n        // mapper oszt\xe1ly megad\xe1sa\n        job.setMapperClass(wordcount.WordCountMapper.class);\n        \n        // reducer oszt\xe1ly megad\xe1sa\n        job.setReducerClass(wordcount.WordCountReducer.class);\n        \n        // kimeneti kulcs \xe9rt\xe9k p\xe1r t\xedpus\xe1nak megad\xe1sa\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(IntWritable.class);\n        \n        // be \xe9s kimeneti k\xf6nyvt\xe1rak megad\xe1sa\n        FileInputFormat.setInputPaths(job, new Path("input")); // bementi mappa\n        FileOutputFormat.setOutputPath(job, new Path("out")); // kimeneti mappa\n        \n        // v\xe9grehajtja a jobot\n        if (!job.waitForCompletion(true)) return;\n    }\n}\n'})}),"\n",(0,a.jsxs)(t.p,{children:["\xc9rtelemszer\u0171en a Mapper f\xe1zis logik\xe1ja a ",(0,a.jsx)(t.code,{children:"WordCountMapper"})," oszt\xe1lyba fog ker\xfclni. A Mapper oszt\xe1lyok k\xf6z\xf6s \u0151soszt\xe1lya\na ",(0,a.jsx)(t.code,{children:"org.apache.hadoop.mapreduce.Mapper"})," generikus oszt\xe1ly:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",children:"public class Mapper<KEYIN, VALUEIN, KEYOUT, VALUEOUT> {\n    protected void map(KEYIN key, VALUEIN value, Context context) throws IOException, InterruptedException { ... }\n    ...\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:"N\xe9gy t\xedpusparam\xe9tere, a bemeneti kulcs t\xedpusa, a bemeneti \xe9rt\xe9k t\xedpusa, a kimeneti kulcs t\xedpusa, a kimeneti \xe9rt\xe9k\nt\xedpusa. A kimeneti kulcs \xe9s \xe9rt\xe9k egy\xfcttesen alkotj\xe1k azt a p\xe1rt ami, majd egy Reducer-hez el fog jutni."}),"\n",(0,a.jsx)(t.admonition,{type:"danger",children:(0,a.jsxs)(t.p,{children:["Figyelj\xfcnk arra, hogy megtartsuk a ",(0,a.jsx)(t.code,{children:"map"})," met\xf3dus szignat\xfar\xe1ja \xe9s az oszt\xe1ly t\xedpusparam\xe9terei k\xf6zti parit\xe1st! Azaz, ha a\n",(0,a.jsx)(t.code,{children:"VALEUIN"})," t\xedpusparam\xe9ter \xe9rt\xe9ke az oszt\xe1lyban ",(0,a.jsx)(t.code,{children:"A"}),", akkor a ",(0,a.jsx)(t.code,{children:"map"})," met\xf3dus ",(0,a.jsx)(t.code,{children:"VALUEIN"})," t\xedpusparam\xe9tere is ",(0,a.jsx)(t.code,{children:"A"})," legyen."]})}),"\n",(0,a.jsxs)(t.admonition,{type:"danger",children:[(0,a.jsx)(t.p,{children:"A Hadoop nem a megszokott Java t\xedpusokat haszn\xe1lja! A t\xedpusok k\xf6zti megfeleltet\xe9seket a k\xf6vetkez\u0151 t\xe1bl\xe1zatok\ntartalmazz\xe1k:"}),(0,a.jsxs)("div",{className:"side-2",children:[(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Java t\xedpus"}),(0,a.jsx)(t.th,{children:"Hadoop t\xedpus"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"byte"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"ByteWritable"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"short"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"ShortWritable"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"int"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"IntWritable"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"long"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"LongWritable"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"float"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"FloatWritable"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"double"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"DoubleWritable"})})]})]})]}),(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Java t\xedpus"}),(0,a.jsx)(t.th,{children:"Hadoop t\xedpus"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"boolean"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"BooleanWritable"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"String"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"Text"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"java.util.Map"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"MapWritable"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"java.util.List"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"ArrayWritable"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"java.util.Set"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"ArrayWritable"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"java.sql.Timestamp"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"LongWritable"})})]})]})]})]})]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",metastring:'title="src/wordcount/WordCountMapper.java"',children:'public class WordCountMapper extends Mapper<LongWritable, Text, Text, IntWritable> {\n    // \xe9rdemes \xedgy \xfajrahaszn\xe1lni a v\xe1ltoz\xf3kat\n    private Text key = new Text("");\n    private IntWritable value = new IntWritable(1); // value \xe9rt\xe9ke konstans 1\n    \n    // ivalue tartalmazza bemeneti \xe9rt\xe9ket\n    // eset\xfcnkben egy f\xe1jl egy sora\n    public void map(LongWritable ikey, Text ivalue, Context context) throws IOException, InterruptedException {\n        // felbontjuk a stringet sz\xf3k\xf6z\xf6k ment\xe9n\n        String[] words = ivalue.toString().split(" ");\n    \n        for (String word : words) {\n            key.set(word); // kulcs legyen a sz\xf3\n            \n            word = word.toLowerCase();\n            \n            // kulcs \xe9rt\xe9k p\xe1r l\xe9trehoz\xe1sa \xe9s tov\xe1bbad\xe1sa\n            context.write(key, value);\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(t.p,{children:"A lek\xe9pz\u0151 oszt\xe1ly meg\xedr\xe1s\xe1val, m\xe1r el\u0151\xe1lltak a reducer \xe1ltal feldolgoz\xe1sra alkalmas kulcs-\xe9rt\xe9k p\xe1rok. A shuffler\nautomatikusan megoldja, hogy az azonos kulcs\xfa p\xe1rok azonos reducer-hez ker\xfcljenek, nek\xfcnk az aggreg\xe1l\xf3 logik\xe1t kell\nmeg\xedrni."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",children:"public class Reducer<KEYIN, VALUEIN, KEYOUT, VALUEOUT> { \n    ...\n    protected void reduce(KEYIN key, Iterable<VALUEIN> values, Context context) throws IOException, InterruptedException { ... }\n    ...\n}\n"})}),"\n",(0,a.jsx)(t.admonition,{type:"danger",children:(0,a.jsxs)(t.p,{children:["Mint a ",(0,a.jsx)(t.code,{children:"map"})," eset\xe9ben, \xfcgyelj\xfcnk arra, hogy megtartsuk a ",(0,a.jsx)(t.code,{children:"reduce"})," met\xf3dus szignat\xfar\xe1ja \xe9s az oszt\xe1ly t\xedpusparam\xe9terei\nk\xf6zti parit\xe1st! Rossz t\xedpusparam\xe9terz\xe9s eset\xe9n a ",(0,a.jsx)(t.code,{children:"reduce"})," eredeti implement\xe1ci\xf3ja fut le, ami csak tov\xe1bbadja a\nkulcs-\xe9rt\xe9k p\xe1rt."]})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",metastring:'title="src/wordcount/WordCountReducer.java"',children:"public class WordCountReducer extends Reducer<Text, IntWritable, Text, IntWritable> {\n    // _key a k\xf6z\xf6s kulcs\n    // values az \xe9rt\xe9kek\n    public void reduce(Text _key, Iterable<IntWritable> values, Context context) throws IOException, InterruptedException {\n        int count = 0;\n        \n        for (IntWritable entryValue : values) {\n            count++;\n        }\n        \n        context.write(_key, new IntWritable(count)); // p\xe1r tov\xe1bbad\xe1sa\n    }\n}\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Ha mindent j\xf3l csin\xe1ltunk l\xe9trej\xf6ttek az \xe1ltal\xe1lunk megadott kimeneti mapp\xe1ba a ",(0,a.jsx)(t.code,{children:"_SUCCESS"})," \xe9s az eredm\xe9nyt tartalmaz\xf3\n",(0,a.jsx)(t.code,{children:"part-m-00000"})," f\xe1jlok."]}),"\n",(0,a.jsxs)(t.admonition,{type:"tip",children:[(0,a.jsx)(t.p,{children:"Combiner oszt\xe1ly haszn\xe1lat\xe1val hat\xe9konyabb megold\xe1st is tudunk adni erre a probl\xe9m\xe1ra. Szerencs\xe9s helyzetben vagyunk,\nmivel a Reducer kis m\xf3dos\xedt\xe1s\xe1val, felhaszn\xe1lhat\xf3 Combiner-k\xe9nt is:"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",metastring:'title="wordCountCombiner/src/wordcount/WordCountReducer.java"',children:"public void reduce(Text _key, Iterable<IntWritable> values, Context context) throws IOException, InterruptedException {\n    int count = 0;\n    \n    for (IntWritable entryValue : values) {\n        //highlight-next-line\n        count += entryValue.get();\n    }\n    \n    context.write(_key, new IntWritable(count));\n}\n"})}),(0,a.jsx)(t.p,{children:"Tov\xe1bb\xe1 be kell regisztr\xe1lnunk a Combiner-t a f\u0151programban:"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",metastring:'title="wordCountCombiner/src/wordcount/WordCountDriver.java"',children:"public static void main(String[] args) throws Exception {\n    ...\n    job.setMapperClass(wordcount_with_combiner.WordCountMapper.class);\n    //highlight-next-line\n    job.setCombinerClass(wordcount_with_combiner.WordCountReducer.class);\n    job.setReducerClass(wordcount.WordCountReducer.class);\n    ...\n}\n"})}),(0,a.jsxs)(t.p,{children:["A megold\xe1s el\xe9rhet\u0151 ",(0,a.jsx)(t.a,{href:"https://github.com/Valentinusz/elte-ik-bsc/tree/main/5/bigdata/hadoop/wordCountCombiner",children:"itt"}),"."]})]})]})}function p(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>i,a:()=>s});var a=n(7294);const r={},o=a.createContext(r);function s(e){const t=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(o.Provider,{value:t},e.children)}}}]);